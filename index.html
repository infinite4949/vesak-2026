<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VESAK GLOBAL LIGHTING | è¡›å¡å…¨çƒåŒæ­¥é»ç‡ˆ</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* (ä¿ç•™ä¹‹å‰çš„ç²¾ç·»æ¨£å¼ï¼Œç‚ºäº†ç¯€çœç©ºé–“æ­¤è™•çœç•¥ï¼Œè«‹æ²¿ç”¨ä¸Šä¸€ç‰ˆçš„ CSS) */
        :root { --primary: #4a0e0e; --gold: #d4af37; }
        body { margin: 0; font-family: 'Noto Serif TC', serif; background: #0f172a; color: #fff; }
        nav { background: rgba(74, 14, 14, 0.9); padding: 15px 30px; display: flex; justify-content: space-between; border-bottom: 2px solid var(--gold); position: sticky; top:0; z-index:1000; }
        .hero-section { padding: 60px 20px; text-align: center; }
        .buddha-img { width: 200px; height: 200px; border-radius: 50%; border: 4px solid var(--gold); object-fit: cover; box-shadow: 0 0 20px var(--gold); }
        #map { height: 600px; width: 95%; max-width: 1100px; margin: 20px auto; border-radius: 30px; border: 5px solid rgba(255,255,255,0.1); }
        .stats-badge { background: var(--gold); color: #4a0e0e; padding: 10px 30px; border-radius: 50px; font-weight: bold; margin-bottom: -20px; position: relative; z-index: 10; display: inline-block; }
        /* è“®èŠ±å‹•ç•« CSS ä¿ç•™è‡ªä¸Šä¸€ç‰ˆ... */
        .lotus-marker { width: 40px; height: 40px; position: relative; }
        .lotus-petal { position: absolute; width: 18px; height: 32px; background: linear-gradient(to bottom, #fffde7, #ffd600, #ff6f00); border-radius: 50% 50% 50% 50% / 85% 85% 15% 15%; bottom: 0; left: 11px; transform-origin: bottom center; animation: lotus-glow 2s infinite alternate ease-in-out; }
        @keyframes lotus-glow { from { transform: scale(0.9) rotate(var(--rot)); } to { transform: scale(1.1) rotate(var(--rot)); filter: brightness(1.2) drop-shadow(0 0 10px yellow); } }
        .p1 { --rot: 0deg; } .p2 { --rot: 35deg; } .p3 { --rot: -35deg; }
    </style>
</head>
<body>

<nav>
    <div id="nav-title">VESAK GLOBAL LIGHTING | è¡›å¡å…¨çƒé»ç‡ˆ</div>
    <button style="background:none; border:1px solid var(--gold); color:var(--gold); padding:5px 15px; border-radius:20px; cursor:pointer;" onclick="toggleLang()">EN / ä¸­æ–‡</button>
</nav>

<div class="hero-section">
    <img src="buddha_vesak.png" class="buddha-img">
    <h2 id="quote-zh" style="color:var(--gold);">ã€Œé¡˜æ…ˆæ‚²ä¹‹å…‰ï¼Œç…§äº®ä¸–ç•Œæ¯ä¸€å€‹è§’è½ã€‚ã€</h2>
    <p id="description">é»æ“Šåœ°åœ–é»äº®è“®èŠ±ï¼Œæ‚¨çš„å–„å¿µå°‡èˆ‡å…¨çƒåŒæ­¥é¡¯ç¤ºã€‚</p>
    <div class="stats-badge">å…¨çƒå·²åŒ¯èšï¼š<span id="count">0</span> ç›å¿ƒç‡ˆ</div>
</div>

<div id="map"></div>

<script type="module">
  // 1. å°å…¥ Firebase
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

  // âš ï¸ è«‹å‹™å¿…ç¢ºèªé€™è£¡è²¼çš„æ˜¯ä½ è‡ªå·±çš„ Firebase é‡‘é‘°
  const firebaseConfig = {
    apiKey: "AIzaSyAspVQZ4NhtQUp_U5Cv-6pV9E39oRlAcWg",
    authDomain: "scoutvesak.firebaseapp.com",
    databaseURL: "https://scoutvesak-default-rtdb.firebaseio.com",
    projectId: "scoutvesak",
    storageBucket: "scoutvesak.firebasestorage.app",
    messagingSenderId: "970243032636",
    appId: "1:970243032636:web:cde5f084f35c4aadc86539",
    measurementId: "G-QJ80DCXFHV"
  };

  // åˆå§‹åŒ– Firebase
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const lightsRef = ref(db, 'lights');

  // 2. èªè¨€è¨­å®šé‚è¼¯
  let currentLang = 'zh';
  const i18n = {
    zh: { 
      nav: "VESAK GLOBAL LIGHTING | è¡›å¡å…¨çƒé»ç‡ˆ", 
      desc: "é»æ“Šåœ°åœ–é»äº®è“®èŠ±ï¼Œæ‚¨çš„å–„å¿µå°‡èˆ‡å…¨çƒåŒæ­¥é¡¯ç¤ºã€‚", 
      countLabel: "å…¨çƒå·²åŒ¯èšï¼š",
      unit: " ç›å¿ƒç‡ˆ",
      quote: "ã€Œé¡˜æ…ˆæ‚²ä¹‹å…‰ï¼Œç…§ç ´ä¸–é–“é»‘æš—ã€‚ã€"
    },
    en: { 
      nav: "VESAK GLOBAL LIGHTING", 
      desc: "Click the map to light a lotus, your good deeds will be synced globally.", 
      countLabel: "Global Deeds Shared: ",
      unit: " Lights",
      quote: "ã€ŒMay the light of compassion illuminate every corner of the world.ã€"
    }
  };

  // å°‡åˆ‡æ›åŠŸèƒ½æ›è¼‰åˆ° windowï¼Œç¢ºä¿æŒ‰éˆ•é»å¾—åˆ°
  window.toggleLang = function() {
    currentLang = currentLang === 'zh' ? 'en' : 'zh';
    document.getElementById('nav-title').innerText = i18n[currentLang].nav;
    document.getElementById('description').innerText = i18n[currentLang].desc;
    document.getElementById('quote-text').innerText = i18n[currentLang].quote;
    updateCountDisplay();
  };

  // 3. åœ°åœ–èˆ‡é»ç‡ˆé‚è¼¯
  const map = L.map('map', {
    center: [20, 0],
    zoom: 2,
    minZoom: 2,
    maxBounds: [[-90, -180], [90, 180]]
  });

  L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);

  const lotusIcon = L.divIcon({
    className: 'lotus-icon',
    html: 'ğŸª·',
    iconSize: [24, 24],
    iconAnchor: [12, 12]
  });

  // é»æ“Šåœ°åœ–å­˜å…¥ Firebase
  map.on('click', function(e) {
    push(lightsRef, {
      lat: e.latlng.lat,
      lng: e.latlng.lng,
      timestamp: Date.now()
    });
  });

  // ç›£è½ Firebase è³‡æ–™æ›´æ–°
  let totalCount = 0;
  onValue(lightsRef, (snapshot) => {
    // æ¸…é™¤èˆŠæ¨™è¨˜ï¼ˆé¿å…é‡è¤‡æ¸²æŸ“ï¼‰
    map.eachLayer((layer) => {
      if (layer instanceof L.Marker) map.removeLayer(layer);
    });

    const data = snapshot.val();
    if (data) {
      const entries = Object.values(data);
      totalCount = entries.length;
      entries.forEach(light => {
        L.marker([light.lat, light.lng], { icon: lotusIcon }).addTo(map);
      });
    } else {
      totalCount = 0;
    }
    updateCountDisplay();
  });

  function updateCountDisplay() {
    const statsBadge = document.querySelector('.stats-badge');
    if (statsBadge) {
      statsBadge.innerHTML = `${i18n[currentLang].countLabel}<span id="count">${totalCount}</span>${i18n[currentLang].unit}`;
    }
  }
</script>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</body>

</html>


