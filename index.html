<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VESAK GLOBAL LIGHTING | 衛塞全球同步點燈</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* (保留之前的精緻樣式，為了節省空間此處省略，請沿用上一版的 CSS) */
        :root { --primary: #4a0e0e; --gold: #d4af37; }
        body { margin: 0; font-family: 'Noto Serif TC', serif; background: #0f172a; color: #fff; }
        nav { background: rgba(74, 14, 14, 0.9); padding: 15px 30px; display: flex; justify-content: space-between; border-bottom: 2px solid var(--gold); position: sticky; top:0; z-index:1000; }
        .hero-section { padding: 60px 20px; text-align: center; }
        .buddha-img { width: 200px; height: 200px; border-radius: 50%; border: 4px solid var(--gold); object-fit: cover; box-shadow: 0 0 20px var(--gold); }
        #map { height: 600px; width: 95%; max-width: 1100px; margin: 20px auto; border-radius: 30px; border: 5px solid rgba(255,255,255,0.1); }
        .stats-badge { background: var(--gold); color: #4a0e0e; padding: 10px 30px; border-radius: 50px; font-weight: bold; margin-bottom: -20px; position: relative; z-index: 10; display: inline-block; }
        /* 蓮花動畫 CSS 保留自上一版... */
        .lotus-marker { width: 40px; height: 40px; position: relative; }
        .lotus-petal { position: absolute; width: 18px; height: 32px; background: linear-gradient(to bottom, #fffde7, #ffd600, #ff6f00); border-radius: 50% 50% 50% 50% / 85% 85% 15% 15%; bottom: 0; left: 11px; transform-origin: bottom center; animation: lotus-glow 2s infinite alternate ease-in-out; }
        @keyframes lotus-glow { from { transform: scale(0.9) rotate(var(--rot)); } to { transform: scale(1.1) rotate(var(--rot)); filter: brightness(1.2) drop-shadow(0 0 10px yellow); } }
        .p1 { --rot: 0deg; } .p2 { --rot: 35deg; } .p3 { --rot: -35deg; }
    </style>
</head>
<body>

<nav>
    <div id="nav-title">VESAK GLOBAL LIGHTING | 衛塞全球點燈</div>
    <button style="background:none; border:1px solid var(--gold); color:var(--gold); padding:5px 15px; border-radius:20px; cursor:pointer;" onclick="toggleLang()">EN / 中文</button>
</nav>

<div class="hero-section">
    <img src="buddha_vesak.png" class="buddha-img">
    <h2 id="quote-zh" style="color:var(--gold);">「願慈悲之光，照亮世界每一個角落。」</h2>
    <p id="description">點擊地圖點亮蓮花，您的善念將與全球同步顯示。</p>
    <div class="stats-badge">全球已匯聚：<span id="count">0</span> 盞心燈</div>
</div>

<div id="map"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getDatabase, ref, push, onValue, onChildAdded } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAspVQZ4NhtQUp_U5Cv-6pV9E39oRlAcWg",
    authDomain: "scoutvesak.firebaseapp.com",
    databaseURL: "https://scoutvesak-default-rtdb.firebaseio.com",
    projectId: "scoutvesak",
    storageBucket: "scoutvesak.firebasestorage.app",
    messagingSenderId: "970243032636",
    appId: "1:970243032636:web:cde5f084f35c4aadc86539",
    measurementId: "G-QJ80DCXFHV"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const pointsRef = ref(db, 'points');

  // --- 1. 佛光菜根譚 清單 ---
  const quotes = [
    "慈悲心是一切功德的母體。",
    "心好命就好，慈悲聖潔好。",
    "給人信心，給人希望，給人喜悅，給人方便。",
    "容人、助人、愛人，是自救救人之道。",
    "提得起是聰明，放得下是智慧。"
  ];

  // --- 2. 完整翻譯字典 ---
  let currentLang = 'zh';
  const i18n = {
    zh: { 
      nav: "VESAK GLOBAL LIGHTING | 衛塞全球點燈", 
      desc: "點擊地圖點亮蓮花，您的善念將與全球同步顯示。", 
      countLabel: "全球已匯聚：", unit: " 盞心燈",
      quote: "「願慈悲之光，照破世間黑暗。」",
      popup: "您已點亮一盞慈悲之光！"
    },
    en: { 
      nav: "VESAK GLOBAL LIGHTING", 
      desc: "Click the map to light a lotus, your good deeds will be synced globally.", 
      countLabel: "Global Deeds Shared: ", unit: " Lights",
      quote: "「May the light of compassion illuminate every corner of the world.」",
      popup: "You have lit a light of compassion!"
    }
  };

  // --- 3. 翻譯執行函式 ---
  window.toggleLang = function() {
    currentLang = currentLang === 'zh' ? 'en' : 'zh';
    document.getElementById('nav-title').innerText = i18n[currentLang].nav;
    document.getElementById('description').innerText = i18n[currentLang].desc;
    document.querySelector('.stats-badge').innerHTML = `${i18n[currentLang].countLabel}<span id="count">${lastCount}</span>${i18n[currentLang].unit}`;
    
    // 確保 quote-text 存在
    const qText = document.getElementById('quote-text');
    if(qText) qText.innerText = i18n[currentLang].quote;
  };

  // --- 4. 地圖功能與點燈 ---
  map.on('click', (e) => {
    const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
    push(pointsRef, {
      lat: e.latlng.lat,
      lng: e.latlng.lng,
      quote: randomQuote,
      timestamp: Date.now()
    });
  });

  let lastCount = 0;
  onChildAdded(pointsRef, (data) => {
    const val = data.val();
    const marker = L.marker([val.lat, val.lng], { icon: lotusIcon }).addTo(map);
    
    // 這裡就是「佛光菜根譚」彈出的地方
    const popupContent = `
      <div style="text-align:center;">
        <b style="color:var(--gold);">${i18n[currentLang].popup}</b><br>
        <p style="font-style:italic; margin-top:5px;">${val.quote || "慈悲喜捨"}</p>
      </div>
    `;
    marker.bindPopup(popupContent).openPopup();
  });

  onValue(pointsRef, (snapshot) => {
    lastCount = snapshot.size || 0;
    document.getElementById('count').innerText = lastCount;
  });
</script>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</body>

</html>



