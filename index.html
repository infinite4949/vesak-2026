<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 Vesak Global Lighting | è¡›å¡å…¨çƒé»ç‡ˆ</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        :root { --gold: #ffd700; --deep-blue: #0a192f; }
        body { margin: 0; background: var(--deep-blue); color: white; font-family: "Microsoft JhengHei", sans-serif; text-align: center; }
        
        /* å°è¦½åˆ—èˆ‡ç¿»è­¯æŒ‰éˆ• */
        nav { padding: 20px; display: flex; justify-content: space-between; background: rgba(10,25,47,0.9); position: fixed; width: 100%; z-index: 1000; box-sizing: border-box; }
        .lang-btn { color: var(--gold); background: none; border: 1px solid var(--gold); padding: 5px 15px; border-radius: 15px; cursor: pointer; }
        
        .hero { padding: 120px 20px 40px; }
        .buddha-img { width: 220px; border-radius: 50%; box-shadow: 0 0 40px var(--gold); margin-bottom: 20px; }
        
        /* åœ°åœ–å®¹å™¨ */
        #map { height: 500px; width: 95%; max-width: 1100px; margin: 20px auto; border-radius: 15px; border: 2px solid var(--gold); z-index: 1; }

        /* è“®èŠ±å‘¼å¸ç‡ˆç‰¹æ•ˆä¿®æ­£ */
        @keyframes breathe {
            0% { transform: scale(1); filter: drop-shadow(0 0 5px gold); }
            50% { transform: scale(1.5); filter: drop-shadow(0 0 20px gold); }
            100% { transform: scale(1); filter: drop-shadow(0 0 5px gold); }
        }
        .lotus-marker { 
            display: flex !important; justify-content: center; align-items: center; 
            font-size: 32px !important; animation: breathe 2s infinite; 
            background: none !important; border: none !important; 
        }

        /* åŠ å¤§ç‰ˆå½ˆå‡ºè¦–çª— */
        .leaflet-popup-content-wrapper { 
            background: #112240 !important; color: white !important; 
            border: 2px solid var(--gold); width: 320px !important; 
        }
        .leaflet-popup-content { font-size: 1.1em; line-height: 1.6; }

        .stats-badge { margin: 20px; color: var(--gold); font-size: 1.3em; border: 2px solid var(--gold); padding: 10px 25px; border-radius: 50px; display: inline-block; }
    </style>
</head>
<body>

<nav>
    <div id="nav-title">VESAK GLOBAL LIGHTING | è¡›å¡å…¨çƒé»ç‡ˆ</div>
    <button class="lang-btn" onclick="toggleLang()">EN / ä¸­æ–‡</button>
</nav>

<div class="hero">
    <img src="buddha_vesak.png" class="buddha-img">
    <h2 id="quote-text">ã€Œé¡˜æ…ˆæ‚²ä¹‹å…‰ï¼Œç…§ç ´ä¸–é–“é»‘æš—ã€‚ã€</h2>
    <p id="description">é»æ“Šåœ°åœ–é»äº®è“®èŠ±ï¼Œæ‚¨çš„å–„å¿µå°‡èˆ‡å…¨çƒåŒæ­¥é¡¯ç¤ºã€‚</p>
    <div class="stats-badge" id="stats-area">
        å…¨çƒå·²åŒ¯èšï¼š<span id="count">0</span> ç›å¿ƒç‡ˆ
    </div>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, push, onValue, onChildAdded } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    // Firebase é…ç½® (è«‹ç¢ºä¿å¡«å…¥æ‚¨è‡ªå·±çš„é‡‘é‘°)
    const firebaseConfig = {
        apiKey: "AIzaSyAspVQZ4NhtQUp_U5Cv-6pV9E39oRlAcWg",
  authDomain: "scoutvesak.firebaseapp.com",
  databaseURL: "https://scoutvesak-default-rtdb.firebaseio.com",
  projectId: "scoutvesak",
  storageBucket: "scoutvesak.firebasestorage.app",
  messagingSenderId: "970243032636",
  appId: "1:970243032636:web:cde5f084f35c4aadc86539",
  measurementId: "G-QJ80DCXFHV"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const pointsRef = ref(db, 'points');

    // èªè¨€ç¿»è­¯å­—å…¸
    let currentLang = 'zh';
    const i18n = {
        zh: { 
            nav: "VESAK GLOBAL LIGHTING | è¡›å¡å…¨çƒé»ç‡ˆ", 
            desc: "é»æ“Šåœ°åœ–é»äº®è“®èŠ±ï¼Œæ‚¨çš„å–„å¿µå°‡èˆ‡å…¨çƒåŒæ­¥é¡¯ç¤ºã€‚", 
            countLabel: "å…¨çƒå·²åŒ¯èšï¼š", unit: " ç›å¿ƒç‡ˆ",
            quote: "ã€Œé¡˜æ…ˆæ‚²ä¹‹å…‰ï¼Œç…§ç ´ä¸–é–“é»‘æš—ã€‚ã€",
            popup: "å·²é»äº®æ…ˆæ‚²ä¹‹å…‰"
        },
        en: { 
            nav: "VESAK GLOBAL LIGHTING", 
            desc: "Click to light a lotus, your deeds will be synced globally.", 
            countLabel: "Global Deeds: ", unit: " Lights",
            quote: "May the light of compassion illuminate the world.",
            popup: "Light of Compassion Lit"
        }
    };

    // 100 å¥æ³•èªæ¸…å–® (ç¯„ä¾‹çµæ§‹)
    const quotes = [
        { zh: "æ…ˆæ‚²å¿ƒæ˜¯ä¸€åˆ‡åŠŸå¾·çš„æ¯é«”ã€‚", en: "Compassion is the mother of all virtues." },
        { zh: "æå¾—èµ·æ˜¯è°æ˜ï¼Œæ”¾å¾—ä¸‹æ˜¯æ™ºæ…§ã€‚", en: "To lift is clever; to let go is wisdom." },
        { zh: "å¿ƒå¥½å‘½å°±å¥½ï¼Œæ…ˆæ‚²è–æ½”å¥½ã€‚", en: "A good heart brings a good life; compassion is holy." }
        // ... æ­¤è™•å¯å¢åŠ è‡³ 100 å¥
    ];

    // å…¨ç¶²é ç¿»è­¯åŠŸèƒ½
    window.toggleLang = function() {
        currentLang = currentLang === 'zh' ? 'en' : 'zh';
        document.getElementById('nav-title').innerText = i18n[currentLang].nav;
        document.getElementById('description').innerText = i18n[currentLang].desc;
        document.getElementById('quote-text').innerText = i18n[currentLang].quote;
        updateDisplay(lastCount);
    };

    // åˆå§‹åŒ–åœ°åœ–
    const map = L.map('map').setView([20, 0], 2);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);

    // ç›£è½é»æ“Šèˆ‡è³‡æ–™å¯«å…¥
    map.on('click', (e) => {
        const q = quotes[Math.floor(Math.random() * quotes.length)];
        push(pointsRef, { lat: e.latlng.lat, lng: e.latlng.lng, q_zh: q.zh, q_en: q.en });
    });

    // ç›£è½æ–°é»ç‡ˆä¸¦é¡¯ç¤ºåŠ å¤§è¦–çª—
    onChildAdded(pointsRef, (data) => {
        const val = data.val();
        const lotusIcon = L.divIcon({ className: 'lotus-marker', html: 'ğŸª·', iconSize: [40, 40], iconAnchor: [20, 20] });
        const marker = L.marker([val.lat, val.lng], { icon: lotusIcon }).addTo(map);
        
        const popupContent = `
            <div style="text-align:center;">
                <b style="color:gold;">${i18n[currentLang].popup}</b>
                <p style="margin:10px 0;">${val.q_zh}</p>
                <p style="font-style:italic; font-size:0.9em; color:#ccc;">${val.q_en}</p>
            </div>`;
        marker.bindPopup(popupContent).openPopup();
    });

    let lastCount = 0;
    function updateDisplay(count) {
        lastCount = count;
        document.getElementById('stats-area').innerHTML = `${i18n[currentLang].countLabel}<span id="count">${count}</span>${i18n[currentLang].unit}`;
    }

    onValue(pointsRef, (snapshot) => { updateDisplay(snapshot.size || 0); });
</script>
</body>
</html>
